name: Deploy

on:
  push:
    branches: [ main ]
    tags: [ 'v*' ]

jobs:
  deploy-staging:
    name: Deploy to Staging
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
    - uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Build Docker image
      uses: docker/build-push-action@v5
      with:
        context: .
        file: ./Dockerfile
        push: false
        tags: blueprint:staging

    - name: Deploy to staging
      run: |
        echo "ğŸš€ Deploying to staging environment"
        # ì‹¤ì œ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•˜ì„¸ìš”
        # ì˜ˆ: docker-compose up -d, kubectl apply, etc.

  deploy-production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v')

    environment:
      name: production
      url: https://your-production-url.com

    steps:
    - uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Build Docker image
      uses: docker/build-push-action@v5
      with:
        context: .
        file: ./Dockerfile
        push: false
        tags: blueprint:${{ github.ref_name }}

    - name: Deploy to production
      run: |
        echo "ğŸš€ Deploying version ${{ github.ref_name }} to production"
        # ì‹¤ì œ í”„ë¡œë•ì…˜ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•˜ì„¸ìš”
